<!DOCTYPE html>
<html lang="vi">
<head>
    <title>Trang chủ</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="~/Content/images1/icons/favicon.png" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/fonts/iconic/css/material-design-iconic-font.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/fonts/linearicons-v1.0.0/icon-font.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/animate/animate.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/css-hamburgers/hamburgers.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/animsition/css/animsition.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/select2/select2.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/daterangepicker/daterangepicker.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/slick/slick.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/MagnificPopup/magnific-popup.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/perfect-scrollbar/perfect-scrollbar.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="~/Content/css1/util.css">
    <link rel="stylesheet" type="text/css" href="~/Content/css1/main.css">
    <!--===============================================================================================-->
</head>
<body>

    <header>
        <!-- Header desktop -->
        <div class="container-menu-desktop">
            <!-- Topbar -->
            <div class="top-bar">
                <div class="content-topbar flex-sb-m h-full container">
                    <div class="left-top-bar">
                        Miễn phí vận chuyển cho đơn hàng trên 10 triệu đồng
                    </div>

                    <div class="right-top-bar flex-w h-full">
                        <a href="#" class="flex-c-m trans-04 p-lr-25">
                            Hỗ trợ & Câu hỏi thường gặp
                        </a>

                        <a href="#" class="flex-c-m trans-04 p-lr-25">
                            Thông tin
                        </a>

                        <a href="#" class="flex-c-m trans-04 p-lr-25">
                            Việt Nam
                        </a>

                        <a href="#" class="flex-c-m trans-04 p-lr-25">
                            VND
                        </a>
                    </div>
                </div>
            </div>

            <div class="wrap-menu-desktop">
                <nav class="limiter-menu-desktop container">

                    <!-- Logo desktop -->
                    <a href="@Url.Action("Index", "Home")" class="logo">
                        <img src="~/Content/images1/icons/logoremove.png" alt="IMG-LOGO">
                    </a>

                    <!-- Menu desktop -->
                    <div class="menu-desktop">
                        <ul class="main-menu">
                            <li class="active-menu">
                                <a href="@Url.Action("Index", "Home")">Trang chủ</a>
                            </li>

                            <li class="label1" data-label1="hot">
                                <a href="@Url.Action("AllListingGrid","ListingGrid")">Sản phẩm</a>
                            </li>

                            <li class="label1" data-label1="new">
                                <a href="@Url.Action("Blog","Home")">Tin tức</a>
                            </li>

                            <li>
                                <a href="@Url.Action("About","Home")">Giới thiệu</a>
                            </li>

                            <li>
                                <a href="@Url.Action("Contact","Home")">Liên hệ</a>
                            </li>
                        </ul>
                    </div>

                    <!-- Icon header -->
                    <div class="wrap-icon-header flex-w flex-r-m">
                        <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">
                            <i class="zmdi zmdi-search"></i>
                        </div>
                        <a>
                            <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti js-show-cart" style="position: relative; display: inline-block;" data-notify="2">
                                <span class="notify" id="CartCount" style="position: absolute; top: -10px; right: -2.4px; background-color: #4d8bf9; color: white; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; border-radius: 50%; line-height: 20px; text-align: center; z-index: 1;">@(Session["count"] ?? "0")</span>
                                <i class="zmdi zmdi-shopping-cart" style="font-size: 24px; color: #333;"></i>
                            </div>
                        </a>

                        <a href="@Url.Action("Wishlist", "ShoppingCart")" class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti js-show-wishlist" style="position: relative; display: inline-block;">
                            <span class="notify" id="WishlistCount" style="position: absolute; top: -10px; right: -2.4px; background-color: #ff6b6b; color: white; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; border-radius: 50%; line-height: 20px; text-align: center; z-index: 1;">
                                @(Session["wishlistCount"] ?? "0")
                            </span>
                            <i class="zmdi zmdi-favorite" style="font-size: 24px; color: #333;"></i>
                        </a>
                        <a href="@Url.Action("OrderTracking", "ShoppingCart")" class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti js-show-orders" style="position: relative; display: inline-block;">
                            <span class="notify" id="OrderCount" style="position: absolute; top: -10px; right: -2.4px; background-color: #ff6f61; color: white; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; border-radius: 50%; line-height: 20px; text-align: center; z-index: 1;">
                                @(Session["orderCount"] ?? "0")
                            </span>
                            <i class="zmdi zmdi-assignment" style="font-size: 24px; color: #333;"></i>
                        </a>
                        @if (Session["idUser"] != null)
                        {
                            <a href="@Url.Action("Profile", "Home")">
                                <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11">
                                    <i class="zmdi zmdi-account"></i>
                                    <span style="font-size: 14px; font-weight: 500; color: #333;">@Session["FullName"]</span>
                                </div>
                            </a>
                        }
                        else
                        {
                            <a href="@Url.Action("Login", "Home")">
                                <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11">
                                    <i class="zmdi zmdi-account"></i>
                                </div>
                            </a>
                        }
                    </div>
                </nav>
            </div>
        </div>

        <!-- Modal Search -->
        <form action="@Url.Action("Search", "Home")" method="GET" class="search-header">
            <div class="modal-search-header flex-c-m trans-06 js-hide-modal-search">
                <div class="container-search-header">
                    <button type="button" class="flex-c-m btn-hide-modal-search trans-06 js-hide-modal-search">
                        <img src="~/Content/images1/icons/icon-close2.png" alt="ĐÓNG">
                    </button>

                    <div class="wrap-search-header flex-w p-l-10">
                        <button type="submit" class="flex-c-m trans-04">
                            <i class="zmdi zmdi-search"></i>
                        </button>
                        <input class="plh3" type="text" name="search" placeholder="Tìm kiếm...">
                    </div>
                </div>
            </div>
        </form>
    </header>

    @RenderBody()

    <footer class="bg3 p-t-75 p-b-32">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-lg-3 p-b-50">
                    <h4 class="stext-301 cl0 p-b-30"> Bộ sưu tập </h4>
                    <ul>
                        <li class="p-b-10"> <a href="#" class="stext-107 cl7 hov-cl1 trans-04"> Đồng hồ nữ </a> </li>
                        <li class="p-b-10"> <a href="#" class="stext-107 cl7 hov-cl1 trans-04"> Đồng hồ nam </a> </li>
                        <li class="p-b-10"> <a href="#" class="stext-107 cl7 hov-cl1 trans-04"> Đồng hồ thông minh </a> </li>
                        <li class="p-b-10"> <a href="#" class="stext-107 cl7 hov-cl1 trans-04"> Đồng hồ cao cấp </a> </li>
                    </ul>
                </div>

                <div class="col-sm-6 col-lg-3 p-b-50">
                    <h4 class="stext-301 cl0 p-b-30"> Hỗ trợ </h4>
                    <ul>
                        <li class="p-b-10"> <a href="#" class="stext-107 cl7 hov-cl1 trans-04"> Theo dõi đơn hàng </a> </li>
                        <li class="p-b-10"> <a href="#" class="stext-107 cl7 hov-cl1 trans-04"> Bảo hành & Đổi trả </a> </li>
                        <li class="p-b-10"> <a href="#" class="stext-107 cl7 hov-cl1 trans-04"> Thông tin vận chuyển </a> </li>
                        <li class="p-b-10"> <a href="#" class="stext-107 cl7 hov-cl1 trans-04"> Câu hỏi về bảo dưỡng đồng hồ </a> </li>
                    </ul>
                </div>

                <div class="col-sm-6 col-lg-3 p-b-50">
                    <h4 class="stext-301 cl0 p-b-30"> Liên hệ </h4>
                    <p class="stext-107 cl7 size-201"> Có câu hỏi về đồng hồ của chúng tôi? Hãy đến tại 321 Đỗ Xuân Hợp, hoặc gọi (+84) 0328858159. Chúng tôi sẵn sàng giúp bạn tìm được chiếc đồng hồ hoàn hảo. </p>
                    <div class="p-t-27">
                        <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16"> <i class="fa fa-facebook"></i> </a>
                        <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16"> <i class="fa fa-instagram"></i> </a>
                        <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16"> <i class="fa fa-pinterest-p"></i> </a>
                    </div>
                </div>

                <div class="col-sm-6 col-lg-3 p-b-50">
                    <h4 class="stext-301 cl0 p-b-30"> Cập nhật thông tin </h4>
                    <form>
                        <div class="wrap-input1 w-full p-b-4">
                            <input class="input1 bg-none plh1 stext-107 cl7" type="text" name="email" placeholder="lechien58159@gmail.com">
                            <div class="focus-input1 trans-04"></div>
                        </div>
                        <div class="p-t-18">
                           
                            <button class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04"> <a href="@Url.Action("Register", "UserRegister")"> Đăng ký ngay</a> </button>
                            
                        </div>
                    </form>
                </div>
            </div>

            <div class="p-t-40">
                <div class="flex-c-m flex-w p-b-18">
                    <a href="#" class="m-all-1"> <img src="~/Content/images1/icons/icon-pay-01.png" alt="ICON-PAY"> </a>
                    <a href="#" class="m-all-1"> <img src="~/Content/images1/icons/icon-pay-02.png" alt="ICON-PAY"> </a>
                    <a href="#" class="m-all-1"> <img src="~/Content/images1/icons/icon-pay-03.png" alt="ICON-PAY"> </a>
                    <a href="#" class="m-all-1"> <img src="~/Content/images1/icons/icon-pay-04.png" alt="ICON-PAY"> </a>
                    <a href="#" class="m-all-1"> <img src="~/Content/images1/icons/icon-pay-05.png" alt="ICON-PAY"> </a>
                </div>
                <p class="stext-107 cl6 txt-center">
                    Bản quyền ©
                    <script>document.write(new Date().getFullYear());</script> Mọi quyền được bảo lưu | Thiết kế bởi <a href="https://colorlib.com" target="_blank">Colorlib</a> & phân phối bởi <a href="https://themewagon.com" target="_blank">ThemeWagon</a>
                </p>
            </div>
        </div>
    </footer>

    <div class="modal fade" id="quickViewModal" tabindex="-1" role="dialog" aria-labelledby="quickViewModalLabel" aria-hidden="true" style="margin-top:100px">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content quick-view-modal">
                <div class="modal-header">
                    <h5 class="modal-title" id="quickViewModalLabel">Xem nhanh sản phẩm</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Product Image Section -->
                        <div class="col-md-6">
                            <div class="product-image-gallery">
                                <img id="modal-main-image" src="" alt="Hình ảnh sản phẩm" class="main-image">
                            </div>
                        </div>
                        <!-- Product Info Section -->
                        <div class="col-md-6 product-info">
                            <h4 id="modal-product-name" class="product-name"></h4>
                            <p id="modal-product-price" class="text-danger product-price"></p>
                            <p id="modal-product-description" class="product-description"></p>

                            <!-- Size and Color Options -->
                            <div class="flex-w flex-r-m p-b-10">
                                <div class="size-203 respon6">
                                    Kích Cỡ
                                </div>

                                <div class="size-204 respon6-next">
                                    <div class="rs1-select2 bor8 bg0">
                                        <select class="js-select2 watch-size" name="size" data-placeholder="Chọn kích thước">
                                            <option value="">Chọn kích thước</option>
                                            <option value="36mm">36mm (Nhỏ gọn)</option>
                                            <option value="40mm">40mm (Tiêu chuẩn)</option>
                                            <option value="42mm">42mm (Trung bình)</option>
                                            <option value="44mm">44mm (Lớn)</option>
                                        </select>
                                        <div class="dropDownSelect2"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex-w flex-r-m p-b-10">
                                <div class="size-203 photons6">
                                    Màu Sắc
                                </div>

                                <div class="size-204 respon6-next">
                                    <div class="rs1-select2 bor8 bg0">
                                        <select class="js-select2 watch-color" name="color" data-placeholder="Chọn màu sắc">
                                            <option value="">Chọn màu sắc</option>
                                            <option value="gold">Vàng hồng 18K</option>
                                            <option value="silver">Bạc (Thép không gỉ)</option>
                                            <option value="black">Đen bóng</option>
                                            <option value="rose-gold">Vàng hồng phấn</option>
                                        </select>
                                        <div class="dropDownSelect2"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quantity and Add to Cart -->
                            <div class="form-group quantity-group">
                                <label for="modal-product-quantity" class="form-label">Số lượng:</label>
                                <div class="quantity-control">
                                    <button type="button" class="btn btn-decrease">-</button>
                                    <input type="number" id="modal-product-quantity" class="form-control quantity-input" value="1" min="1">
                                    <button type="button" class="btn btn-increase">+</button>
                                </div>
                            </div>

                            <button class="add-to-cart" id="addtocart">
                                <span class="icon">🛒</span>
                                <span class="text">Thêm vào giỏ hàng</span>
                            </button>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CSS -->
    <style>
        .quick-view-modal {
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            font-family: 'Roboto', sans-serif;
            background: #fdfdfd;
            max-width: auto;
        }

        .modal-header {
            border-bottom: 2px solid #f0f0f0;
            padding: 20px;
            background: #f9fafc;
            border-radius: 12px 12px 0 0;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .modal-header .close {
            font-size: 1.6rem;
            color: #555;
            transition: all 0.4s ease;
        }

            .modal-header .close:hover {
                color: #ff6b6b;
                transform: scale(1.2);
            }

        .main-image {
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

            .main-image:hover {
                transform: scale(1.04);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            }

        .add-to-cart {
            background: linear-gradient(90deg, #1e88e5, #42a5f5);
            border: none;
            color: #fff;
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 50px;
            padding: 12px 30px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 15px rgba(30, 136, 229, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

            .add-to-cart .icon {
                font-size: 1.5rem;
            }

            .add-to-cart:hover {
                background: linear-gradient(90deg, #42a5f5, #1e88e5);
                transform: translateY(-3px);
                box-shadow: 0 12px 20px rgba(30, 136, 229, 0.3);
            }

            .add-to-cart:active {
                transform: translateY(1px);
                box-shadow: 0 6px 10px rgba(30, 136, 229, 0.2);
            }

            .add-to-cart::after {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                background: rgba(255, 255, 255, 0.3);
                transform: translate(-50%, -50%);
                border-radius: 50%;
                opacity: 0;
                transition: width 0.4s ease, height 0.4s ease, opacity 0.8s ease;
            }

            .add-to-cart:active::after {
                width: 200%;
                height: 200%;
                opacity: 0;
                transition: 0s;
            }

        .custom-select {
            border-radius: 8px;
            border: 1px solid #ced4da;
            padding: 10px;
            font-size: 1.1rem;
            background: #f9fafc;
            color: #333;
            transition: border 0.3s ease, box-shadow 0.3s ease;
        }

            .custom-select:hover {
                border-color: #ff6b6b;
                box-shadow: 0 0 5px rgba(255, 105, 135, 0.4);
            }

        /* Styles for discount pricing in Quick View */
        .quickview-original-price {
            text-decoration: line-through;
            color: #999;
            margin-right: 10px;
        }

        .quickview-discounted-price {
            color: #e74c3c;
            font-weight: bold;
        }

        .quickview-discount-percentage {
            font-size: 0.9rem;
            color: #e74c3c;
            margin-left: 10px;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
$(document).ready(function() {
    $('.quick-view-btn').click(function() {
        var productId = $(this).data('id');
        $('#quickViewModal').data('product-id', productId);
        $('#quickViewModal').modal('show');
    });

    $("#addtocart").click(function(e) {
        e.preventDefault();
        var model = {
            Id: $('#quickViewModal').data('product-id'),
            Quantity: parseInt($("#modal-product-quantity").val()) || 1
        };
        console.log("Sending:", JSON.stringify(model));
        $.ajax({
            type: "POST",
            url: '@Url.Action("AddToCart", "ShoppingCart")',
            data: JSON.stringify(model),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function(response) {
                $('#CartCount').text(response.count);
                $('#quickViewModal').modal('hide');
                Swal.fire('Thành công!', 'Thêm vào giỏ hàng thành công!', 'success');
            },
            error: function(xhr, status, error) {
                console.log("Status:", status);
                console.log("Error:", error);
                console.log("Response:", xhr.responseText);
                alert("Có lỗi xảy ra khi thêm vào giỏ hàng: " + xhr.responseText);
            }
        });
        return false;
    });

    $('.btn-increase').click(function() {
        var input = $('#modal-product-quantity');
        input.val(parseInt(input.val()) + 1);
    });

    $('.btn-decrease').click(function() {
        var input = $('#modal-product-quantity');
        var val = parseInt(input.val());
        if (val > 1) {
            input.val(val - 1);
        }
    });
});
    </script>

    <script src="@Url.Content("~/Content/vendor/animsition/js/animsition.min.js")"></script>
    <script src="@Url.Content("~/Content/vendor/bootstrap/js/popper.js")"></script>
    <script src="@Url.Content("~/Content/vendor/bootstrap/js/bootstrap.min.js")"></script>
    <script src="@Url.Content("~/Content/vendor/select2/select2.min.js")"></script>
    <script>
        $(".js-select2").each(function () {
            $(this).select2({
                minimumResultsForSearch: 20,
                dropdownParent: $(this).next('.dropDownSelect2')
            });
        })
    </script>
    <script src="@Url.Content("~/Content/vendor/daterangepicker/moment.min.js")"></script>
    <script src="@Url.Content("~/Content/vendor/daterangepicker/daterangepicker.js")"></script>
    <script src="@Url.Content("~/Content/vendor/slick/slick.min.js")"></script>
    <script src="@Url.Content("~/Content/js1/slick-custom.js")"></script>
    <script src="@Url.Content("~/Content/vendor/parallax100/parallax100.js")"></script>
    <script>
        $('.parallax100').parallax100();
    </script>
    <script src="@Url.Content("~/Content/vendor/MagnificPopup/jquery.magnific-popup.min.js")"></script>
    <script>
        $('.gallery-lb').each(function () {
            $(this).magnificPopup({
                delegate: 'a',
                type: 'image',
                gallery: {
                    enabled: true
                },
                mainClass: 'mfp-fade'
            });
        });
    </script>
    <script src="@Url.Content("~/Content/vendor/isotope/isotope.pkgd.min.js")"></script>
    <script src="@Url.Content("~/Content/vendor/sweetalert/sweetalert.min.js")"></script>

    <script src="@Url.Content("~/Content/vendor/perfect-scrollbar/perfect-scrollbar.min.js")"></script>
    <script>
        $('.js-pscroll').each(function () {
            $(this).css('position', 'relative');
            $(this).css('overflow', 'hidden');
            var ps = new PerfectScrollbar(this, {
                wheelSpeed: 1,
                scrollingThreshold: 1000,
                wheelPropagation: false,
            });
            $(window).on('resize', function () {
                ps.update();
            })
        });
    </script>
    <script src="@Url.Content("~/Content/js1/main.js")"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const quickViewButtons = document.querySelectorAll(".quick-view-btn");
            quickViewButtons.forEach(button => {
                button.addEventListener("click", function () {
                    // Reset quantity input to 1
                    const quantityInput = document.getElementById('modal-product-quantity');
                    if (quantityInput) quantityInput.value = 1;

                    const productId = this.getAttribute("data-id");
                    fetch(`/Product/GetProductDetails?id=${productId}`)
                        .then(response => response.json())
                        .then(response => {
                            if (!response || !response.success) {
                                console.error('Không tìm thấy sản phẩm hoặc lỗi:', response.message || 'Unknown error');
                                Swal.fire('Lỗi!', response.message || 'Không tìm thấy sản phẩm.', 'error');
                                return;
                            }

                            const product = response.data;

                            const mainImage = document.getElementById('modal-main-image');
                            const productName = document.getElementById('modal-product-name');
                            const productPrice = document.getElementById('modal-product-price');
                            const productDescription = document.getElementById('modal-product-description');

                            if (mainImage) mainImage.src = `/Content/images1/${product.Avatar || 'default-image.jpg'}`;
                            if (productName) productName.textContent = product.Name || 'Không có tên';
                            if (productDescription) productDescription.textContent = product.FullDescription || 'Không có mô tả';
                            if (productPrice) {
                                let priceHtml = '';
                                const originalPriceValue = product.Price ? Number(product.Price) : 0;
                                const discountPriceValue = product.PriceDiscount ? Number(product.PriceDiscount) : 0;
                                // Only apply discount if the product is in the discountedProductIds list
                                const isDiscounted = typeof discountedProductIds !== 'undefined' && discountedProductIds.includes(product.Id);
                                if (isDiscounted && discountPriceValue > 0 && discountPriceValue < originalPriceValue) {
                                    let originalPrice = (originalPriceValue * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                                    originalPrice = originalPrice.replace(' đ', ' đ');
                                    let discountedPrice = (discountPriceValue * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                                    discountedPrice = discountedPrice.replace(' đ', ' đ');
                                    const discountPercentage = Math.round(((originalPriceValue - discountPriceValue) / originalPriceValue) * 100);
                                    priceHtml = `
                                    <span class="quickview-original-price">${originalPrice}</span>
                                    <span class="quickview-discounted-price">${discountedPrice}</span>
                                    <span class="quickview-discount-percentage">(-${discountPercentage}%)</span>
                                `;
                                } else {
                                    let originalPrice = originalPriceValue
                                        ? (originalPriceValue * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })
                                        : 'Không có giá';
                                    originalPrice = originalPrice.replace(' đ', ' đ');
                                    priceHtml = `${originalPrice}`;
                                }
                                productPrice.innerHTML = priceHtml;
                            }

                            $("#quickViewModal").modal("show");
                        })
                        .catch(error => {
                            console.error('Lỗi khi lấy chi tiết sản phẩm:', error);
                            Swal.fire('Lỗi!', 'Không thể tải chi tiết sản phẩm. Vui lòng thử lại sau.', 'error');
                        });
                });
            });
        });
    </script>
    <style>
        .add-to-wishlist {
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
            border: none;
            color: #fff;
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 50px;
            padding: 12px 30px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 15px rgba(255, 107, 107, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            margin-top: 10px;
        }

            .add-to-wishlist .icon {
                font-size: 1.5rem;
            }

            .add-to-wishlist:hover {
                background: linear-gradient(90deg, #ff8e8e, #ff6b6b);
                transform: translateY(-3px);
                box-shadow: 0 12px 20px rgba(255, 107, 107, 0.3);
            }

            .add-to-wishlist:active {
                transform: translateY(1px);
                box-shadow: 0 6px 10px rgba(255, 107, 107, 0.2);
            }

            .add-to-wishlist::after {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                background: rgba(255, 255, 255, 0.3);
                transform: translate(-50%, -50%);
                border-radius: 50%;
                opacity: 0;
                transition: width 0.4s ease, height 0.4s ease, opacity 0.8s ease;
            }

            .add-to-wishlist:active::after {
                width: 200%;
                height: 200%;
                opacity: 0;
                transition: 0s;
            }

        .quantity-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .quantity-label {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .quantity-control {
            display: flex;
            align-items: center;
        }

        .quantity-input {
            text-align: center;
            width: 60px;
            height: 40px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 0 10px;
            font-size: 1rem;
        }

        .btn {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            color: #333;
            font-size: 1.2rem;
            line-height: 1;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

            .btn:hover {
                background-color: #ddd;
                border-color: #999;
            }

        .btn-decrease,
        .btn-increase {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const decreaseBtn = document.querySelector(".btn-decrease");
            const increaseBtn = document.querySelector(".btn-increase");
            const quantityInput = document.getElementById("modal-product-quantity");
            decreaseBtn.addEventListener("click", () => {
                const currentValue = parseInt(quantityInput.value, 10) || 1;
                if (currentValue > 1) {
                    quantityInput.value = currentValue - 1;
                }
            });
            increaseBtn.addEventListener("click", () => {
                const currentValue = parseInt(quantityInput.value, 10) || 1;
                quantityInput.value = currentValue + 1;
            });
        });
    </script>
    @*Xem Nhanh cart*@
    <div class="wrap-header-cart js-panel-cart" aria-hidden="true">
        <div class="s-full js-hide-cart"></div>
        <div class="header-cart flex-col-l p-l-65 p-r-25">
            <div class="header-cart-title flex-w flex-sb-m p-b-8">
                <span class="mtext-103 cl2">Giỏ hàng của bạn</span>
                <button class="fs-35 lh-10 cl2 p-lr-5 pointer hov-cl1 trans-04 js-hide-cart" aria-label="Đóng giỏ hàng">
                    <i class="zmdi zmdi-close"></i>
                </button>
            </div>
            <div class="header-cart-content flex-w js-pscroll">
                <div id="cart-loading" style="display: none; text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i> Đang tải...
                </div>
                <ul class="header-cart-wrapitem w-full" id="cart-items"></ul>
                <div class="w-full" id="cart-summary">
                    <div class="header-cart-total w-full p-tb-40">
                        Tổng cộng: <span id="cart-total">0.000 VNĐ</span>
                    </div>
                    <div class="header-cart-buttons flex-w w-full">
                        <a href="@Url.Action("AllShoppingCart", "ShoppingCart")" class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-r-8 m-b-10">
                            Xem giỏ hàng
                        </a>
                        <a href="@Url.Action("Checkout", "Home")" class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-b-10">
                            Thanh Toán
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        .header-cart-item {
            position: relative;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .header-cart-item-img img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .header-cart-item-txt {
            flex: 1;
            padding-left: 15px;
        }

        .remove-cart-item {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            background: #ff6b6b;
            border: none;
            color: #fff;
            padding: 5px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s ease;
        }

            .remove-cart-item:hover {
                background: #e55a5a;
            }

        #cart-loading {
            font-size: 16px;
            color: #555;
        }

        .wrap-header-cart, .s-full {
            display: none;
        }
    </style>
    <script>
        $(document).ready(function () {
        const cartContent = document.querySelector('.js-pscroll');
        if (cartContent) {
            new PerfectScrollbar(cartContent);
        }

        // Check if the current page is the cart page
        const isCartPage = window.location.pathname.toLowerCase().includes('/shoppingcart/allshoppingcart');

        // Disable cart icon visually if on cart page
        if (isCartPage) {
            $('.js-show-cart').addClass('disabled');
        }

        // Toggle cart panel
        function toggleCartPanel(show) {
            console.log('toggleCartPanel called with show:', show);
            const cartPanel = $('.wrap-header-cart');
            const overlay = $('.s-full');

            if (!cartPanel.length || !overlay.length) {
                console.error('Cart panel or overlay not found');
                return;
            }

            if (show) {
                cartPanel.addClass('active').css('display', 'block');
                overlay.addClass('active').css('display', 'block');
            } else {
                cartPanel.removeClass('active').css('display', 'none');
                overlay.removeClass('active').css('display', 'none');
            }
        }

        // Fetch and render cart items
        function fetchCartItems() {
            $('#cart-loading').show();
            $('#cart-items').hide();
            $('#cart-summary').hide();

            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetCartItems", "ShoppingCart")',
                dataType: 'json',
                cache: false,
                success: function (response) {
                    if (response.success) {
                        renderCartItems(response.items, response.total);
                    } else {
                        Swal.fire('Error!', response.message || 'Failed to load cart. Please try again later.', 'error');
                        renderCartItems([], 0);
                    }
                },
                error: function (xhr) {
                    console.error('Error fetching cart items:', xhr.responseText);
                    let errorMessage = 'Failed to load cart. Please try again later.';
                    if (xhr.status === 404) {
                        errorMessage = 'Cart service not found. Please contact support.';
                    } else if (xhr.status === 401) {
                        errorMessage = 'Please log in to view your cart.';
                    } else if (xhr.status === 500) {
                        errorMessage = 'Server error. Please try again later or contact support.';
                    }
                    Swal.fire('Error!', errorMessage, 'error');
                    render止CartItems([], 0);
                },
                complete: function () {
                    $('#cart-loading').hide();
                    $('#cart-items').fadeIn();
                    $('#cart-summary').fadeIn();
                }
            });
        }

        // Render cart items
        function renderCartItems(items, total) {
            const cartList = $('#cart-items');
            const cartTotal = $('#cart-total');
            cartList.empty();

            if (!items || items.length === 0) {
                cartList.append(`
                    <li class="header-cart-item flex-w flex-t m-b-12">
                        Giỏ hàng trống.
                        <a href="@Url.Action("AllListingGrid", "ListingGrid")" class="text-primary">Tiếp tục mua sắm</a>
                    </li>
                `);
                cartTotal.text('0 VNĐ');
                $('#CartCount').text('0');
                return;
            }

            items.forEach(item => {
                const priceToUse = item.CartPrice;
                const formattedPrice = (priceToUse * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                let priceDisplay = '';

                const isDiscounted = typeof discountedProductIds !== 'undefined' && discountedProductIds.includes(item.ProductId);
                if (isDiscounted && item.PriceDiscount && item.PriceDiscount < item.Price) {
                    const originalPrice = (item.Price * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
                    const discountPercentage = Math.round(((item.Price - item.PriceDiscount) / item.Price) * 100);
                    priceDisplay = `
                        <span style="text-decoration: line-through; color: #999;">${originalPrice}</span>
                        <span style="color: #e74c3c;">${formattedPrice}</span>
                        <span style="color: #e74c3c; font-size: 0.9rem;">(-${discountPercentage}%)</span>
                    `;
                } else {
                    priceDisplay = formattedPrice;
                }

                const cartItem = `
                    <li class="header-cart-item flex-w flex-t m-b-12" data-product-id="${item.ProductId}">
                        <div class="header-cart-item-img">
                            <img src="/Content/images1/${item.Avatar}" alt="${item.Name}" onerror="this.src='/Content/images1/default-image.jpg'">
                        </div>
                        <div class="header-cart-item-txt p-t-8">
                            <a href="/Product/Detail/${item.ProductId}" class="header-cart-item-name m-b-18 hov-cl1 trans-04">
                                ${item.Name}
                            </a>
                            <span class="header-cart-item-info">
                                ${item.Quantity} x ${priceDisplay}
                            </span>
                            <button class="remove-cart-item btn btn-sm btn-danger" data-product-id="${item.ProductId}">
                                <i class="zmdi zmdi-delete"></i>
                            </button>
                        </div>
                    </li>`;
                cartList.append(cartItem);
            });

            cartTotal.text((total * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }));
            $('#CartCount').text(items.reduce((sum, item) => sum + item.Quantity, 0));

            $('.remove-cart-item').on('click', function () {
                const productId = $(this).data('product-id');
                removeCartItem(productId);
            });
        }

        // Remove cart item
        function removeCartItem(productId) {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("Remove", "ShoppingCart")',
                data: { id: productId },
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        Swal.fire('Success!', 'Product removed from cart.', 'success');
                        fetchCartItems();
                    } else {
                        Swal.fire('Error!', response.message || 'Failed to remove product. Please try again.', 'error');
                    }
                },
                error: function () {
                    Swal.fire('Error!', 'Failed to remove product. Please try again later.', 'error');
                }
            });
        }

        // Unified event handler for cart panel
        let isCartOpen = false;
        let hideTimeout;

        function handleCartInteraction(show) {
            if (isCartPage) {
                console.log('On cart page, skipping cart panel interaction');
                return;
            }

            clearTimeout(hideTimeout);

            if (show && !isCartOpen) {
                console.log('Showing cart panel');
                fetchCartItems();
                toggleCartPanel(true);
                isCartOpen = true;
            } else if (!show && isCartOpen) {
                console.log('Scheduling cart panel hide');
                hideTimeout = setTimeout(() => {
                    console.log('Hiding cart panel');
                    toggleCartPanel(false);
                    isCartOpen = false;
                }, 500); // Increased timeout for better UX
            }
        }

        // Event listeners for cart icon and panel
        const cartElements = $('.js-show-cart, .wrap-header-cart, .s-full');

        cartElements.on('mouseenter', function () {
            handleCartInteraction(true);
        });

        cartElements.on('mouseleave', function (e) {
            const relatedTarget = e.relatedTarget;
            // Only hide if leaving to an element outside the cart elements
            if (!$(relatedTarget).closest('.js-show-cart, .wrap-header-cart, .s-full').length) {
                handleCartInteraction(false);
            }
        });

        // Close cart on Escape key
        $(document).on('keydown', function (event) {
            if (event.key === 'Escape' && isCartOpen) {
                console.log('Escape key pressed, closing cart');
                handleCartInteraction(false);
            }
        });

        // Close cart on close button click
        $('.js-hide-cart').on('click', function (event) {
            event.preventDefault();
            event.stopPropagation();
            console.log('Close button clicked');
            handleCartInteraction(false);
        });

        // Prevent clicks inside the cart panel from closing it
        $('.wrap-header-cart').on('click', function (event) {
            event.stopPropagation();
        });
    });
    </script>
    <style>
        .header-cart-item {
            position: relative;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .header-cart-item-img img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .header-cart-item-txt {
            flex: 1;
            padding-left: 15px;
        }

        .remove-cart-item {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            background: #ff6b6b;
            border: none;
            color: #fff;
            padding: 5px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.1s ease;
        }

            .remove-cart-item:hover {
                background: #e55a5a;
            }

        #cart-loading {
            font-size: 16px;
            color: #555;
        }

        .wrap-header-cart, .s-full {
            display: none;
        }

        /* Add disabled state for cart icon */
        .js-show-cart.disabled {
            cursor: not-allowed;
            opacity: 0.2;
        }

            .js-show-cart.disabled:hover {
                color: #333; /* Prevent color change on hover */
                transform: none; /* Prevent hover animation */
            }

    </style>
    @RenderSection("Scripts", required: false)
</body>
</html>